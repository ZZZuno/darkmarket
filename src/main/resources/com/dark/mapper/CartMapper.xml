<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dark.mapper.CartMapper">

<insert id="cart_add" parameterType="com.dark.domain.CartVO">

merge 
	into cart_tbl
USING
	dual
ON
	(DARK_ID = #{dark_id} and ITEM_NUM = #{item_num})
WHEN	
	matched then
UPDATE
	SET CART_AMOUNT = CART_AMOUNT + #{cart_amount}
WHEN
	not matched then
INSERT (CART_CODE, ITEM_NUM, DARK_ID, CART_AMOUNT)
VALUES (seq_cart_code.nextval, #{item_num}, #{dark_id}, #{cart_amount})
</insert>

<select id="cart_list" resultType="com.dark.dto.CartDTOList">

		SELECT
   			C.CART_CODE, C.ITEM_NUM, C.CART_AMOUNT, I.ITEM_NAME, I.ITEM_PRICE, I.ITEM_IMG, I.ITEM_DISCOUNT, I.ITEM_UP_FOLDER
   		FROM
   			ITEM_TBL I INNER JOIN CART_TBL C
   		ON
   			I.ITEM_NUM = C.ITEM_NUM
   		WHERE
   			C.DARK_ID = #{dark_id}

</select>

<update id="cart_amount_change" parameterType="map">

UPDATE
	CART_TBL
SET
	CART_AMOUNT = #{cart_amount}
WHERE
	CART_CODE = #{cart_code}

</update>

<delete id="cart_list_del" parameterType="Long">

DELETE FROM
	CART_TBL
WHERE
	CART_CODE = #{cart_code}

</delete>

</mapper>