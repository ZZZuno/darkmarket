<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dark.mapper.AdProductMapper">

<insert id="pro_insert" parameterType="com.dark.domain.ItemVO">

INSERT INTO
    ITEM_TBL(item_num, CG_CODE, ITEM_NAME, ITEM_PRICE, ITEM_DISCOUNT, ITEM_PUBLISHER, ITEM_CONTENT, ITEM_UP_FOLDER, ITEM_IMG, ITEM_AMOUNT, ITEM_BUY)
    VALUES(SEQ_ITEM_TBL.nextval, #{cg_code}, #{item_name}, #{item_price}, #{item_discount}, #{item_publisher}, #{item_content}, #{item_up_folder}, #{item_img}, #{item_amount}, #{item_buy})

</insert>

	<!-- 공통된 sql구문작업 : 검색조건 -->
	<sql id="criteria">
		<trim prefix="(" suffix=") AND" prefixOverrides="OR">
			<foreach collection="typeArr" item="type">
				<trim prefix="OR">
					<choose>
						<when test="type == 'N'.toString()">
                            ITEM_NAME like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'C'.toString()">
                            ITEM_NUM  like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'P'.toString()">
							ITEM_PUBLISHER like '%' || #{keyword} || '%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	
	</sql>
	
	
	<!--  CDATA 섹션 -->
	<select id="pro_list" resultType="com.dark.domain.ItemVO" parameterType="com.dark.dto.Criteria">
		<![CDATA[
		select 
    		ITEM_NUM, CG_CODE, ITEM_NAME, ITEM_PRICE, ITEM_DISCOUNT, ITEM_PUBLISHER, ITEM_CONTENT, ITEM_UP_FOLDER, ITEM_IMG, ITEM_AMOUNT, ITEM_BUY, ITEM_DATE, ITEM_UPDATEDATE
		from 
		    (
		    select /*+INDEX_DESC(ITEM_TBL pk_item_num) */
		        rownum rn, ITEM_NUM, CG_CODE, ITEM_NAME, ITEM_PRICE, ITEM_DISCOUNT, ITEM_PUBLISHER, ITEM_CONTENT, ITEM_UP_FOLDER, ITEM_IMG, ITEM_AMOUNT, ITEM_BUY, ITEM_DATE, ITEM_UPDATEDATE
		    from 
		        ITEM_TBL
		    where 
		    ]]>
		    
		    <include refid="criteria"></include>
		    
		    <![CDATA[
		        rownum <= #{pageNum} * #{amount}
		    )
		where 
		    rn > (#{pageNum} -1) * #{amount}
		]]>
	</select>
	
	<select id="getTotalCount" resultType="int">
		select count(*) from ITEM_TBL where
		
		<include refid="criteria"></include>
		
		ITEM_NUM > 0
	</select>
	
	<update id="pro_checked_modify" parameterType="map">
	
	UPDATE
		ITEM_TBL
	SET
		ITEM_PRICE = #{item_price},
		ITEM_BUY = #{item_buy}
	WHERE
		ITEM_NUM = #{item_num}	
	
	
	</update>
	
	<select id="pro_edit" parameterType="Integer" resultType="com.dark.domain.ItemVO">
	
	SELECT 
		ITEM_NUM, CG_CODE, ITEM_NAME, ITEM_PRICE, ITEM_DISCOUNT, ITEM_PUBLISHER, ITEM_CONTENT, ITEM_UP_FOLDER, ITEM_IMG, ITEM_AMOUNT, ITEM_BUY
	FROM 
		ITEM_TBL
	WHERE
		ITEM_NUM = #{item_num}
	</select>
	
	<update id="pro_edit_ok" parameterType="com.dark.domain.ItemVO">
	
		UPDATE
			ITEM_TBL
		SET
			CG_CODE = #{cg_code}, ITEM_NAME = #{item_name}, ITEM_PRICE = #{item_price}, 
			ITEM_DISCOUNT = #{item_discount}, ITEM_PUBLISHER = #{item_publisher}, 
			ITEM_CONTENT = #{item_content}, ITEM_UP_FOLDER = #{item_up_folder}, 
			ITEM_IMG = #{item_img}, ITEM_AMOUNT = #{item_amount}, ITEM_BUY =#{item_buy}, ITEM_UPDATEDATE = SYSDATE
		WHERE
			ITEM_NUM = #{item_num}
	
	</update>
	
	<delete id="pro_delete" parameterType="Integer">
	
	DELETE FROM
		ITEM_TBL
	WHERE
		ITEM_NUM = #{item_num}
		
	</delete>
	
	
</mapper>