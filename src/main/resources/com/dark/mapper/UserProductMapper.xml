<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dark.mapper.UserProductMapper">

	<!--  CDATA 섹션 -->
	<select id="pro_list" resultType="com.dark.domain.ItemVO" parameterType="map">
		<![CDATA[
		select 
    		ITEM_NUM, 
    		CG_CODE, 
    		ITEM_NAME, 
    		ITEM_PRICE, 
    		ITEM_DISCOUNT, 
    		ITEM_PUBLISHER, 
    		ITEM_CONTENT, 
    		ITEM_UP_FOLDER, 
    		ITEM_IMG, 
    		ITEM_AMOUNT, 
    		ITEM_BUY, 
    		ITEM_DATE, 
    		ITEM_UPDATEDATE
    		ITEM_TITLE
		from 
		    (
		    select /*+INDEX_DESC(ITEM_TBL pk_item_num) */
		        rownum rn, ITEM_NUM, CG_CODE, ITEM_NAME, ITEM_PRICE, ITEM_DISCOUNT, ITEM_PUBLISHER, ITEM_CONTENT, ITEM_UP_FOLDER, ITEM_IMG, ITEM_AMOUNT, ITEM_BUY, ITEM_DATE, ITEM_UPDATEDATE, ITEM_TITLE
		    from 
		        ITEM_TBL
		    where 
		    	CG_CODE = #{cg_code}
		      AND
		        rownum <= #{cri.pageNum} * #{cri.amount}
		    )
		where 
		    rn > (#{cri.pageNum} -1) * #{cri.amount}
		and
			ITEM_BUY = 'Y'
		]]>
	</select>
	
	<select id="getTotalCount" parameterType="Integer" resultType="int">
		select
			count(*)
		from
			item_tbl
		where
			cg_code = #{cg_code}
	</select>
	
	<select id="pro_detail" parameterType="Integer" resultType="com.dark.domain.ItemVO">
	
		SELECT
			ITEM_NUM, CG_CODE, ITEM_NAME, ITEM_PRICE, ITEM_DISCOUNT, ITEM_PUBLISHER, 
			ITEM_CONTENT, ITEM_UP_FOLDER, ITEM_IMG, ITEM_AMOUNT, ITEM_BUY, ITEM_DATE, ITEM_UPDATEDATE
		FROM
			ITEM_TBL
		WHERE
			ITEM_NUM = #{item_num}
	
	</select>
	
	<select id="pro_title" resultType="com.dark.domain.ItemVO" parameterType="com.dark.dto.Criteria">
		<![CDATA[
		select 
    		ITEM_NUM, 
    		CG_CODE, 
    		ITEM_NAME, 
    		ITEM_PRICE, 
    		ITEM_DISCOUNT, 
    		ITEM_PUBLISHER, 
    		ITEM_CONTENT, 
    		ITEM_UP_FOLDER, 
    		ITEM_IMG, 
    		ITEM_AMOUNT, 
    		ITEM_BUY, 
    		ITEM_DATE, 
    		ITEM_UPDATEDATE
    		ITEM_TITLE
		from 
		    (
		    select /*+INDEX_DESC(ITEM_TBL pk_item_num) */
		        rownum rn, ITEM_NUM, CG_CODE, ITEM_NAME, ITEM_PRICE, ITEM_DISCOUNT, ITEM_PUBLISHER, ITEM_CONTENT, ITEM_UP_FOLDER, ITEM_IMG, ITEM_AMOUNT, ITEM_BUY, ITEM_DATE, ITEM_UPDATEDATE, ITEM_TITLE
		    from 
		        ITEM_TBL
		    where 
		    	ITEM_TITLE = 'Y'
		      AND
		        rownum <= #{pageNum} * #{amount}
		    )
		where 
		    rn > (#{pageNum} -1) * #{amount}
		and
			ITEM_BUY = 'Y'
		]]>
	</select>
	
	<select id="getTitleTotalCount" parameterType="String" resultType="int">
		select
			count(*)
		from
			item_tbl
		where
			item_title = 'Y'
	</select>

</mapper>